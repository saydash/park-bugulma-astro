---
import BaseLayout from "../layouts/BaseLayout.astro";
// Импортируем наши инструменты из utils
import { getPosts, getCleanText, getFeaturedImage } from "../utils.js";

// 1. Получаем живые данные (или локальные, если настроили гибрид в utils)
const posts = await getPosts();

// 2. Настройка категорий (ID из твоего скриншота)
const CAT_AFISHA = 5;
const CAT_EVENTS = 6;
const CAT_SMI = 7;

// Фильтруем основные разделы
const afisha = posts
	.filter((p) => p.categories.includes(CAT_AFISHA))
	.slice(0, 3);
const reports = posts
	.filter((p) => p.categories.includes(CAT_EVENTS))
	.slice(0, 4);
const smi = posts.filter((p) => p.categories.includes(CAT_SMI)).slice(0, 5);

// Титл для вкладки браузера
const pageTitle = "Главная — Парк Бугульма";
---

<BaseLayout title={pageTitle}>
	<!-- ГЛАВНЫЙ БЛОК (HERO) -->
<section class="relative h-[85vh] w-full overflow-hidden bg-[#222222]">
  <img 
    src="https://parkbugulma.ru/wp-content/uploads/oparkehead.jpg" 
    class="absolute inset-0 w-full h-full object-cover opacity-60 grayscale-[0.2]"
    alt="Панорама парка Бугульма"
  />
  
  <!-- Затемнение для глубины -->
  <div class="absolute inset-0 bg-gradient-to-b from-[#222222]/40 via-transparent to-[#222222]/80"></div>
  
  <!-- Контент по центру -->
  <div class="relative z-10 h-full max-w-7xl mx-auto px-6 flex flex-col items-center justify-center text-center">
    
    <!-- Тонкая бирюзовая линия над заголовком -->
    <div class="mb-8 h-px w-24 bg-teal-500 shadow-[0_0_15px_rgba(20,184,166,0.8)]"></div>
    
    <h1 class="text-6xl md:text-[120px] font-black text-white tracking-tighter uppercase leading-[0.8] mb-10 drop-shadow-2xl">
      Детский <br/> 
      <span class="font-light italic opacity-90">Парк</span>
    </h1>
    
    <p class="text-lg md:text-xl text-white/70 max-w-2xl font-light leading-relaxed mb-12 tracking-tight">
      Главная точка притяжения Бугульмы. Место, где история города <br class="hidden md:block"/> встречается с современным отдыхом.
    </p>

    <!-- КНОПКА КАРТЫ С БИРЮЗОВЫМ АКЦЕНТОМ -->
    <a 
      href="/map" 
      class="group relative inline-flex items-center gap-4 px-10 py-4 border border-white/30 rounded-full text-white text-[11px] font-bold uppercase tracking-[0.3em] overflow-hidden transition-all duration-500 hover:border-teal-500 no-underline"
    >
      <!-- Эффект бирюзового свечения при наведении -->
      <div class="absolute inset-0 bg-teal-600 translate-y-full group-hover:translate-y-0 transition-transform duration-500 -z-10"></div>
      
      <svg xmlns="http://www.w3.org" class="h-4 w-4 text-teal-400 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      
      <span class="group-hover:text-white transition-colors">Посмотреть карту парка</span>
    </a>
  </div>
</section>

	<!-- СЕКЦИЯ 1: АФИША (Чистая плитка) -->
	<section class="max-w-7xl mx-auto px-6 py-24">
  <!-- Заголовок с бирюзовым акцентом и кнопкой -->
<div class="flex flex-col md:flex-row justify-between items-center md:items-end mb-12 border-b border-[#e5e5e5] pb-10 gap-6">
  <h2 class="text-4xl md:text-6xl font-bold tracking-tighter uppercase text-[#222222]">
    Афиша <span class="font-light italic text-teal-600 opacity-30 ml-2">событий</span>
  </h2>
  
  <a 
    href="/events" 
    class="px-8 py-3 border-2 border-teal-600 rounded-lg text-[13px] font-bold uppercase tracking-widest text-[#222222] hover:text-teal-600 transition-all duration-300 no-underline shadow-sm hover:shadow-md active:scale-95"
  >
    Смотреть все
  </a>
</div>

		<div class="grid grid-cols-1 md:grid-cols-3 gap-1">
			{
				afisha.map((post) => (
					<a
						href={`/events/${decodeURIComponent(post.slug)}`}
						class="group relative aspect-[4/5] overflow-hidden bg-kz-gray no-underline"
					>
						<img
							src={getFeaturedImage(post)}
							class="absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110"
							alt=""
						/>
						<div class="absolute inset-0 bg-gradient-to-t from-kz-dark/90 via-kz-dark/20 to-transparent opacity-80 transition-opacity group-hover:opacity-100" />

						<div class="absolute bottom-0 left-0 p-8 w-full">
							<time class="text-[10px] text-white/50 font-bold uppercase tracking-[0.2em] mb-3 block">
								{new Date(post.date).toLocaleDateString(
									"ru-RU",
								)}
							</time>
							<h3
								class="text-2xl font-bold text-white leading-tight"
								set:html={post.title.rendered}
							/>
						</div>
					</a>
				))
			}
		</div>
	</section>

<!-- СЕКЦИЯ 2: СОБЫТИЯ (ОТЧЕТЫ) -->
<section class="bg-white py-24 border-t border-[#e5e5e5]">
  <div class="max-w-7xl mx-auto px-6">
    
    <!-- Единый стиль заголовка с кнопкой -->
    <div class="flex flex-col md:flex-row justify-between items-center md:items-end mb-16 border-b border-[#e5e5e5] pb-10 gap-6">
      <h2 class="text-4xl md:text-6xl font-bold tracking-tighter uppercase text-[#222222]">
        Как это <span class="font-light italic opacity-30 text-teal-600">было</span>
      </h2>
      
      <a 
        href="/reports" 
        class="px-8 py-3 border-2 border-teal-600 rounded-lg text-[13px] font-bold uppercase tracking-widest text-[#222222] hover:text-teal-600 transition-all duration-300 no-underline shadow-sm hover:shadow-md active:scale-95"
      >
        Смотреть все
      </a>
    </div>
    
    <!-- Сетка с эффектом тонких разделителей (gap-px) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-[#e5e5e5] border border-[#e5e5e5] overflow-hidden">
      {reports.map((post) => (
        <a 
  href={`/events/${decodeURIComponent(post.slug)}`} 
  class="group flex flex-col md:flex-row gap-8 bg-white p-10 no-underline transition-all duration-500 hover:bg-[#fafafa]"
>
  <!-- Квадратное превью: всегда цветное + зум при наведении -->
  <div class="relative w-full md:w-44 h-44 bg-[#f4f4f4] overflow-hidden flex-shrink-0 rounded-sm shadow-sm">
     <img 
       src={getFeaturedImage(post)} 
       class="w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-110" 
       alt={post.title.rendered}
     />
     <!-- Мягкий бирюзовый блик при наведении (опционально) -->
     <div class="absolute inset-0 bg-teal-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
  </div>

  <div class="flex flex-col justify-center">
    <time class="text-[10px] font-bold text-teal-600 uppercase tracking-[0.2em] mb-4 opacity-70 group-hover:opacity-100 transition-opacity">
       {new Date(post.date).toLocaleDateString('ru-RU')}
    </time>
    
    <h3 
      class="text-xl font-bold text-[#222222] leading-tight mb-4 group-hover:text-teal-700 transition-colors" 
      set:html={post.title.rendered} 
    />
    
    <p class="text-sm text-[#222222]/50 line-clamp-2 leading-relaxed font-light">
      {getCleanText(post.content.rendered).substring(0, 120)}...
    </p>
    
    <!-- Тонкая стрелочка-указатель -->
    <div class="mt-6 flex items-center text-teal-600 text-[10px] font-black uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all -translate-x-3 group-hover:translate-x-0">
      Перейти к событию <span class="ml-2">→</span>
    </div>
  </div>
</a>
      ))}
    </div>
  </div>
</section>

<!-- СЕКЦИЯ 3: СМИ О НАС -->
<!-- Изменили max-w-4xl на max-w-7xl, чтобы выровнять по краям с Афишей -->
<section class="max-w-7xl mx-auto px-6 py-32 border-t border-[#e5e5e5]">
  
  <!-- Заголовок и кнопка теперь будут по краям широкого контейнера -->
  <div class="flex flex-col md:flex-row justify-between items-center md:items-end mb-16 pb-10 gap-6 border-b border-[#e5e5e5]">
    <h2 class="text-4xl md:text-6xl font-bold tracking-tighter uppercase text-[#222222]">
      СМИ <span class="font-light italic text-teal-600 opacity-30 ml-2">о нас</span>
    </h2>
    
    <a 
      href="/news" 
      class="px-8 py-3 border-2 border-teal-600 rounded-lg text-[13px] font-bold uppercase tracking-widest text-[#222222] hover:text-teal-600 transition-all duration-300 no-underline shadow-sm hover:shadow-md active:scale-95"
    >
      Все публикации
    </a>
  </div>

  <!-- Чтобы сам список новостей не был слишком растянутым на больших экранах, 
       ограничим только внутренний блок списка (опционально) -->
  <div class="divide-y divide-[#e5e5e5] max-w-5xl">
    {smi.map((post) => (
      <a 
        href={`/events/${decodeURIComponent(post.slug)}`} 
        class="group flex flex-col md:flex-row md:items-center justify-between py-8 no-underline transition-all"
      >
        <div class="flex flex-col gap-2">
          <time class="text-[10px] font-bold text-teal-600 uppercase tracking-[0.2em] opacity-50 group-hover:opacity-100 transition-opacity">
            {new Date(post.date).toLocaleDateString('ru-RU')}
          </time>
          <h3 
            class="text-xl md:text-2xl font-bold text-[#222222] group-hover:translate-x-2 transition-transform duration-500 ease-out leading-tight" 
            set:html={post.title.rendered} 
          />
        </div>

        <div class="mt-4 md:mt-0 text-teal-600 opacity-0 group-hover:opacity-100 transition-all -translate-x-4 group-hover:translate-x-0">
          <svg xmlns="http://www.w3.org" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </div>
      </a>
    ))}
  </div>
</section>
<section class="max-w-7xl mx-auto px-6 py-24">
  <div class="flex flex-col md:flex-row justify-between items-end mb-16 border-b border-[#e5e5e5] pb-10 gap-6">
    <h2 class="text-4xl md:text-6xl font-bold tracking-tighter uppercase text-[#222222]">
      Карта <span class="font-light italic text-teal-600 opacity-30 ml-2">парков</span>
    </h2>
  </div>

  <!-- Контейнер для карты с нашими скруглениями -->
  <div class="w-full h-[600px] bg-kz-gray overflow-hidden border border-kz-border relative">
    <!-- ВСТАВЬТЕ ВАШ КОД ИЗ КОНСТРУКТОРА НИЖЕ -->
    <script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A3680b2aa886fdba8dbc8bb3752211e7da748fd1f816dc47b7808c3c3777f1fa1&amp;width=100%25&amp;height=589&amp;lang=ru_RU&amp;scroll=true"></script>
  </div>
</section>

</BaseLayout>

<style>
	/* Локальные правки, если нужно */
	:global(body) {
		background-color: white;
	}
</style>
